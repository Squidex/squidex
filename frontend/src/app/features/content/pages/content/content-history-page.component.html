<sqx-layout layout="right" titleText="i18n:common.workflow" width="20" white="true" overflow="true" padding="true">
    <ng-container>
        <div class="section mb-2">
            <label for="id">{{ "common.id" | sqxTranslate }}</label>

            <div class="input-group">
                <input class="form-control" id="id" #inputId readonly name="id" value="{{ content.id }}" />

                <button class="btn btn-outline-secondary" [sqxCopy]="inputId" type="button">
                    <i class="icon-copy"></i>
                </button>
            </div>
        </div>
        <div class="section mb-4">
            <label for="version">{{ "common.version" | sqxTranslate }}</label>
            :
            <span id="version">{{ content.version }}</span>
        </div>

        @if (content.canDraftCreate || content.canDraftDelete) {
            <div class="section mb-4">
                @if (!content.newStatus) {
                    <button class="btn btn-success btn-block" (click)="createDraft()">
                        {{ "contents.draftNew" | sqxTranslate }}
                    </button>
                } @else {
                    <label>{{ "contents.draftStatus" | sqxTranslate }}</label>
                    <button
                        class="btn btn-outline-secondary btn-block btn-status"
                        #buttonOptions
                        (click)="dropdownNew.toggle()"
                        type="button"
                        sqxTourStep="status">
                        <sqx-content-status
                            [status]="content.newStatus!"
                            [statusColor]="content.newStatusColor!"
                            [scheduled]="content.scheduleJob"
                            layout="multiline"></sqx-content-status>
                    </button>
                    <sqx-dropdown-menu *sqxModal="dropdownNew; closeAlways: true" [sqxAnchoredTo]="buttonOptions" scrollY="true">
                        @if (content.statusUpdates.length > 0) {
                            @for (info of content.statusUpdates; track info) {
                                <a class="dropdown-item" (click)="changeStatus(info.status)">
                                    {{ "common.statusChangeTo" | sqxTranslate }}
                                    <i class="icon-circle icon-sm" [style.color]="info.color"></i>
                                    {{ info.status }}
                                </a>
                            }
                            <div class="dropdown-divider"></div>
                        }
                        <a
                            class="dropdown-item dropdown-item-delete"
                            [class.disabled]="!content.canDraftDelete"
                            (sqxConfirmClick)="deleteDraft()"
                            confirmTitle="i18n:contents.deleteConfirmTitle"
                            confirmText="i18n:contents.deleteVersionConfirmText"
                            confirmRememberKey="deleteDraft">
                            {{ "contents.versionDelete" | sqxTranslate }}
                        </a>
                        <div class="dropdown-divider"></div>
                        <a
                            class="dropdown-item dropdown-item-delete"
                            [class.disabled]="!content.canDelete"
                            (sqxConfirmClick)="delete()"
                            confirmTitle="i18n:contents.deleteConfirmTitle"
                            confirmText="i18n:contents.deleteConfirmText"
                            confirmRememberKey="deleteContent">
                            {{ "common.delete" | sqxTranslate }}
                        </a>
                    </sqx-dropdown-menu>
                }
            </div>
        }

        <div class="section">
            <label>{{ "contents.currentStatusLabel" | sqxTranslate }}</label>

            @if (!content.newStatus) {
                <div>
                    <button
                        class="btn btn-outline-secondary btn-block btn-status"
                        #buttonOptions
                        (click)="dropdown.toggle()"
                        type="button"
                        sqxTourStep="status">
                        <sqx-content-status
                            [status]="content.status"
                            [statusColor]="content.statusColor"
                            [scheduled]="content.scheduleJob"
                            layout="multiline"
                            small="true"></sqx-content-status>
                    </button>
                    <sqx-dropdown-menu *sqxModal="dropdown; closeAlways: true" [sqxAnchoredTo]="buttonOptions" scrollY="true">
                        @if (content.statusUpdates.length > 0) {
                            @for (info of content.statusUpdates; track info) {
                                <a class="dropdown-item" (click)="changeStatus(info.status)">
                                    {{ "common.statusChangeTo" | sqxTranslate }}
                                    <sqx-content-status
                                        [status]="info.status"
                                        [statusColor]="info.color"
                                        layout="text"
                                        small="true"></sqx-content-status>
                                </a>
                            }
                            <div class="dropdown-divider"></div>
                        }
                        <a
                            class="dropdown-item dropdown-item-delete"
                            [class.disabled]="!content.canCancelStatus"
                            (sqxConfirmClick)="cancelStatus()"
                            confirmTitle="i18n:contents.cancelStatusConfirmTitle"
                            confirmText="i18n:contents.cancelStatusConfirmText"
                            confirmRememberKey="cancelStatus">
                            {{ "contents.cancelStatus" | sqxTranslate }}
                        </a>
                        <div class="dropdown-divider"></div>
                        <a
                            class="dropdown-item dropdown-item-delete"
                            [class.disabled]="!content.canDelete"
                            (sqxConfirmClick)="delete()"
                            confirmTitle="i18n:contents.deleteConfirmTitle"
                            confirmText="i18n:contents.deleteConfirmText"
                            confirmRememberKey="deleteContent">
                            {{ "common.delete" | sqxTranslate }}
                        </a>
                    </sqx-dropdown-menu>
                </div>
            } @else {
                <button class="btn btn-outline-secondary btn-block btn-status" type="button">
                    <sqx-content-status
                        [status]="content.status"
                        [statusColor]="content.statusColor"
                        layout="multiline"></sqx-content-status>
                </button>
            }

            <sqx-form-hint marginTop="1">
                {{ "contents.lastUpdatedLabel" | sqxTranslate }}: {{ content.lastModified | sqxFromNow }}
            </sqx-form-hint>
        </div>

        <div class="section">
            <h3 class="bordered">{{ "common.history" | sqxTranslate }}</h3>

            @for (event of contentEvents | async; track event.eventId) {
                <sqx-content-event
                    [content]="content"
                    [event]="event"
                    (dataLoad)="loadVersion(event)"
                    (dataCompare)="compareVersion(event)"></sqx-content-event>
            }
        </div>
    </ng-container>
</sqx-layout>

<sqx-due-time-selector #dueTimeSelector [disabled]="disableScheduler"></sqx-due-time-selector>
