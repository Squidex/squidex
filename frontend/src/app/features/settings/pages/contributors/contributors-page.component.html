<sqx-title message="i18n:common.contributors"></sqx-title>

<sqx-layout layout="main" titleText="i18n:common.contributors" titleIcon="contributors" innerWidth="55">
    <ng-container menu>
        <sqx-notifo topic="apps/{{ contributorsState.appId }}/settings/contributors"></sqx-notifo>

        <button
            class="btn btn-text-secondary me-2"
            (click)="reload()"
            type="button"
            title="i18n:contributors.refreshTooltip"
            shortcut="CTRL + B">
            <i class="icon-reset"></i>
            {{ "common.refresh" | sqxTranslate }}
        </button>

        <div class="form-inline">
            <input
                class="form-control"
                [ngModel]="contributorsState.query | async"
                (ngModelChange)="search($event)"
                placeholder="{{ 'contributors.search' | sqxTranslate }}"
                shortcut="CTRL + I"
                shortcutAction="focus" />
        </div>
    </ng-container>

    <ng-container>
        <sqx-list-view [isLoading]="contributorsState.isLoading | async" innerWidth="55rem">
            <ng-container>
                @if (rolesState.roles | async; as roles) {
                    @if (contributorsState.maxContributors | async; as maxContributors) {
                        @if (maxContributors > 0) {
                            <div class="alert alert-success mb-4">
                                {{ "contributors.planHint" | sqxTranslate: { maxContributors: maxContributors } }}
                            </div>
                        }
                    }
                    @if (contributorsState.canCreate | async) {
                        <sqx-contributor-add-form [roles]="roles"></sqx-contributor-add-form>
                    }
                }

                @if ((contributorsState.isLoaded | async) && (contributorsState.contributorsFiltered | async); as contributors) {
                    @if (rolesState.roles | async; as roles) {
                        @if (contributors.length === 0) {
                            <div class="table-items-row table-items-row-summary table-items-row-empty">
                                {{ "contributors.empty" | sqxTranslate }}
                            </div>
                        }
                        <table class="table table-items table-fixed">
                            @for (contributor of contributors; track trackByContributor($index, contributor)) {
                                <tbody
                                    [sqxContributor]="contributor"
                                    [search]="contributorsState.queryRegex | async"
                                    [roles]="roles"></tbody>
                            }
                        </table>
                    }
                }
            </ng-container>

            <ng-container footer>
                <sqx-pager [paging]="contributorsState.paging | async" (pagingChange)="contributorsState.page($event)"></sqx-pager>
            </ng-container>
        </sqx-list-view>
    </ng-container>

    <ng-template sidebarMenu>
        <div class="panel-nav">
            <a
                class="panel-link"
                replaceUrl="true"
                routerLink="history"
                routerLinkActive="active"
                queryParamsHandling="preserve"
                title="i18n:common.history"
                titlePosition="left"
                sqxTourStep="help">
                <i class="icon-time"></i>
            </a>

            <a
                class="panel-link"
                replaceUrl="true"
                routerLink="help"
                routerLinkActive="active"
                queryParamsHandling="preserve"
                title="i18n:common.help"
                titlePosition="left"
                sqxTourStep="help">
                <i class="icon-help2"></i>
            </a>
        </div>
    </ng-template>
</sqx-layout>

<router-outlet></router-outlet>
