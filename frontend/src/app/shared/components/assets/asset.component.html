@if (!isListView) {
    <div
        class="card"
        [class.selectable]="isSelectable"
        [class.border-primary]="isSelected"
        [sqxDropDisabled]="!asset || !asset.canUpload"
        (click)="selectAsset.emit()"
        (sqxDropFile)="updateFile($event)"
        sqxDropNoPaste="true">
        <div class="card-body">
            @if (asset && snapshot.progress === 0) {
                <div class="file-preview">
                    @if (asset.fileType) {
                        <span class="file-type">
                            {{ asset.fileType }}
                        </span>
                    }

                    @if (asset.canPreview) {
                        <div class="file-image">
                            <img [sqxImageSource]="asset | sqxAssetPreviewUrl" layoutKey="asset-large" />
                        </div>
                    } @else {
                        <div class="file-icon">
                            <img [src]="asset | sqxFileIcon" />
                        </div>
                    }

                    <div class="overlay">
                        <div class="overlay-background"></div>

                        <div class="overlay-menu">
                            @if (!isDisabled) {
                                <a class="file-edit ms-2" (click)="emitEdit()">
                                    <i class="icon-pencil"></i>
                                </a>
                            }

                            <a
                                class="file-download ms-2"
                                [href]="asset | sqxAssetUrl: asset.version : false"
                                sqxStopClick
                                sqxExternalLink="noicon">
                                <i class="icon-download"></i>
                            </a>

                            @if (folderIcon) {
                                <a class="file-folder ms-2" (click)="selectFolder.emit(asset.parentId)">
                                    <i class="icon-folder"></i>
                                </a>
                            }

                            @if (!isDisabled && !removeMode && asset.canDelete) {
                                <a
                                    class="file-delete ms-2"
                                    (sqxConfirmClick)="delete.emit()"
                                    confirmTitle="i18n:assets.deleteConfirmTitle"
                                    confirmText="i18n:assets.deleteConfirmText"
                                    confirmRememberKey="deleteAsset">
                                    <i class="icon-delete"></i>
                                </a>
                            }

                            @if (!isDisabled && removeMode) {
                                <a
                                    class="file-delete ms-2"
                                    (sqxConfirmClick)="remove.emit()"
                                    confirmTitle="i18n:assets.removeConfirmTitle"
                                    confirmText="i18n:assets.removeConfirmText"
                                    confirmRememberKey="removeAsset">
                                    <i class="icon-close"></i>
                                </a>
                            }
                        </div>

                        @if (asset.fileType) {
                            <span class="overlay-type">
                                {{ asset.fileType }}
                            </span>
                        }

                        <div class="overlay-user">
                            <div>
                                <i class="icon-user"></i>
                                {{ asset.lastModifiedBy | sqxUserNameRef }}
                            </div>
                            <div>
                                {{ asset.lastModified | sqxFromNow }}
                            </div>
                        </div>
                    </div>

                    <div class="drop-overlay align-items-center justify-content-center">
                        <div class="drop-overlay-background"></div>
                        <div class="drop-overlay-text">{{ "assets.dropToUpdate" | sqxTranslate }}</div>
                    </div>
                </div>

                @if (snapshot.progress > 0) {
                    <div class="upload-progress">
                        <sqx-progress-bar [value]="snapshot.progress" mode="Circle"></sqx-progress-bar>
                    </div>
                }
            }

            @if (asset) {
                <div class="card-footer" (dblclick)="emitEdit()">
                    <div>
                        <div class="file-name truncate editable" (click)="emitEdit()">
                            @if (asset.isProtected) {
                                <i class="icon-lock"></i>
                            }

                            {{ asset.fileName }}
                        </div>
                    </div>
                    <div class="file-tags tags">
                        @for (tag of asset.tags; track tag) {
                            <div class="tag">{{ tag }}</div>
                        }
                    </div>
                    <div class="file-info">
                        {{ asset.metadataText }}
                    </div>
                </div>
            }
        </div>
    </div>
} @else {
    <div
        class="table-items-row table-items-row-summary"
        [class.selectable]="isSelectable"
        [sqxDropDisabled]="!asset || !asset.canUpload"
        [sqxDropNoPaste]="true"
        (click)="selectAsset.emit()"
        (sqxDropFile)="updateFile($event)">
        <div class="left-border" [class.hidden]="!isSelectable" [class.selected]="isSelected"></div>

        @if (asset && snapshot.progress === 0) {
            @if (asset.canPreview) {
                <div class="image" [class.image-left]="!isSelectable">
                    <img class="bg2" [sqxImageSource]="asset | sqxAssetPreviewUrl" layoutKey="asset-small" />
                </div>
            } @else {
                <div class="image image-padded" [class.image-left]="!isSelectable">
                    <img class="icon" [src]="asset | sqxFileIcon" />
                </div>
            }

            <table class="table-fixed">
                <tr>
                    <td class="col-name">
                        <div class="file-name truncate editable" (click)="emitEdit()">
                            @if (asset.isProtected) {
                                <i class="icon-lock"></i>
                            }

                            {{ asset.fileName }}
                        </div>
                    </td>

                    @if (!isCompact) {
                        <td class="col-info">
                            <div class="truncate">{{ asset.metadataText }}</div>
                        </td>
                        <td class="col-user">
                            <img
                                class="user-picture"
                                [src]="asset.lastModifiedBy | sqxUserPictureRef"
                                title="{{ asset.lastModifiedBy | sqxUserNameRef }}" />
                        </td>
                        <td class="col-actions text-end">
                            <a
                                class="btn btn-text-secondary"
                                [href]="asset | sqxAssetUrl: asset.version : false"
                                sqxStopClick
                                sqxExternalLink="noicon">
                                <i class="icon-download"></i>
                            </a>

                            @if (folderIcon) {
                                <button class="btn btn-text-secondary" (click)="selectFolder.emit(asset.parentId)" type="button">
                                    <i class="icon-folder"></i>
                                </button>
                            }
                        </td>
                    }

                    <td class="col-delete text-end">
                        @if (!isDisabled && !removeMode && asset.canDelete) {
                            <button
                                class="btn btn-text-danger"
                                [disabled]="isDisabled"
                                (sqxConfirmClick)="delete.emit()"
                                type="button"
                                confirmTitle="i18n:assets.deleteConfirmTitle"
                                confirmText="i18n:assets.deleteConfirmText"
                                confirmRememberKey="deleteAsset">
                                <i class="icon-bin2"></i>
                            </button>
                        }

                        @if (!isDisabled && removeMode) {
                            <button
                                class="btn btn-text-secondary"
                                [disabled]="isDisabled"
                                (sqxConfirmClick)="remove.emit()"
                                type="button"
                                confirmTitle="i18n:assets.removeConfirmTitle"
                                confirmText="i18n:assets.removeConfirmText"
                                confirmRememberKey="removeAsset">
                                <i class="icon-close"></i>
                            </button>
                        }
                    </td>
                </tr>
            </table>

            <div class="drop-overlay align-items-center justify-content-center">
                <div class="drop-overlay-background"></div>
                <div class="drop-overlay-text">{{ "assets.dropToUpdate" | sqxTranslate }}</div>
            </div>
        }

        @if (snapshot.progress > 0) {
            <div class="upload-progress">
                <sqx-progress-bar [value]="snapshot.progress" [trailWidth]="0.8" [strokeWidth]="0.8" [showText]="false"></sqx-progress-bar>
            </div>
        }
    </div>
}
